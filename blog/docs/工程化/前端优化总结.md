---
sidebar: auto
---

# 前端优化总结

- 在脚本中尽量减少DOM操作，避免过度触发重排重绘

- 使用CSS动画代替JS动画

  JS 动画会触发高频率的重排重绘(但是可以使用 `requestAnimationFrame` 优化)

  CSS3动画可以开始CPU硬件加速，简单动画使用 CSS3 实现代码比较简洁，但是强制使用了 GPU 的硬件加速，也会导致浏览器一直处于高负荷运转的状态，这反而会让动画变的卡顿

- 请求开启缓存和压缩`Content-Encoding: gzip`

- 预加载

- 图片懒加载

- 模块、组件按需加载

- 小图片使用 base64 请求请求或图片合并

- CDN 加载资源

- HTTP2.0

- webpack tree shiking、压缩

- 首屏渲染问题

## 图片相关

### 图片懒加载

1. 首先，将图片的地址放在其它属性(data-url)中，而不是 src。

2. 页面加载时根据 scrollTop 的值判断图片是否在可视区域,如果在可视区域，则将 data-url 属性中的值取出存放到src属性中（首屏的图片可以直接加载）。

3. 在滚动过程中，判断图片是否在可视区域，如果在，则将 data-url 属性中的值放到 src 属性中

如何判断图片在可视区域？

1. 根据滚动条高度和图片位置信息进行判断

2. 使用 `Intersection Observer API` (推荐)

### css sprite

css sprite（CSS精灵或者雪碧图），即将几个小的图片合并在一张图片中，利用 `background-position` 来显示对应的图片

这种方式的优点表现在：

- 减少了请求资源的请求

- 可以利用到缓存

这种方式要注意合并图片的大小，过大的话反而适得其反

### base64

优点：无需额外的请求

缺点：额外增加了 HTML/CSS 文件的大小

### 字体图标

优点：无需额外的请求，使用灵活（可以方便得控制大小、颜色等）

## 首屏渲染相关

### 延迟加载 JS 资源

DOM 渲染和 JS 执行是互斥的，所以正常情况下我们应该优先进行 DOM 的渲染，优化方式：

- JS脚本的加载和执行尽量后在文档后面

- 加载外部 JS 资源时添加 `defer` 或 `async` 属性

   **defer 和 async 在网络读取这块是一样都是异步的**。区别在于：
   
   - `defer` 属性脚本的执行是在所有元素解析完成之后，DOMContentLoaded 事件触发之前完成，并且当包含多个 `defer` 标签的传本时，它是按照加载顺序执行脚本的
   
   - `async` 的脚本并不保证按照指定它们的先后顺序执行。对它来说脚本的加载和执行是紧紧挨着的，所以不管你声明的顺序如何，只要它加载完了就会立刻执行


## 预加载

当浏览器读到 `reload` 或 `prefetch` 属性的 `link` 标签时，就是在对资源进行下载。下载完成后会将资源缓存起来。下次以正常方式加载相关资源的时候就直接从缓存中获取

### reload

```html
 <link rel="preload" href="style.css" as="style">
 <link rel="preload" href="main.js" as="script">
```

`reload` 一般用于当前页面要使用脚本

### prefetch

```html
<link rel="prefetch" href="main.js">
```

与 `prefetch` 类似，但它是意图预获取一些资源，以备下一个导航/页面使用（比如，当你去到下一个页面时）。

`prefetch` 的优先级比 `preload` 低，毕竟当前的页面比下一个页面相对更加重要

**webpack code split时配置预加载**

```js
import(/* webpackPrefetch: true */ './path/to/LoginModal.js')
import(/* webpackPreload: true */ 'ChartingLibrary')
```

### DNS 预解析

DNS-prefetch (DNS 预获取) 是尝试在请求资源之前解析域名。这可能是后面要加载的文件，也可能是用户尝试打开的链接目标

**页面使用预解析**

```html
<meta http-equiv="x-dns-prefetch-control" content="on" /> <!--告诉浏览器，当前页面要做DNS预解析-->
<link rel="dns-prefetch" href="//bdimg.share.baidu.com" /> <!--使用link标签来强制查询特定主机名-->
```

**HTTP中使用预解析**

```
Link: <https://fonts.gstatic.com/>; rel=dns-prefetch
```

:::tip
dns-prefetch 仅对跨域域上的 DNS查找有效，因此请避免使用它来指向您的站点或域。这是因为，到浏览器看到提示时，您站点域背后的IP已经被解析
:::

## Gzip -> Brotil

Brotli 压缩算法具有多个特点，最典型的是以下 3 个：

针对常见的 Web 资源内容，Brotli 的性能相比 Gzip 提高了 17-25%；
当 Brotli 压缩级别为 1 时，压缩率比 Gzip 压缩等级为 9（最高）时还要高；
在处理不同 HTML 文档时，Brotli 依然能够提供非常高的压缩率。