# 登录系统

设计一个安全的登录系统要注意的地方：

- 使用 `Https` 协议进行传输，虽然相比 `http` 多了几次会话，但是在安全方面得到了显著提升

- 强制用户使用有一定强度且复杂的密码

- 密码不要明文保存到数据库，可对密码进行 `MD5` 之后再进入存储，加密之前一般将密码加上一个不固定的 `salt` 值一起拼接加密，一般 `md5(md5(password) + salt)` 就可以了，这个 `salt` 是盐，一起加密增加密码的长度也增加了破解的难度，盐一般设计为 `64位` 随机生成的字符串，最好分开存放，假如用户信息库被攻击了黑客也拿不到盐的库。不能使用可逆的算法，如果可逆，那如何保存密钥是个非常棘手的问题，一般使用明文加密与数据库中的密文对比就能确定密码正确与否，我们不需要知道用户的明文是什么，如果用户忘了可以通过重置或者密码保护问题修改密码，这也比总明文存储要好一万倍。

  :::tip
  `MD5` 现在已经不是十分安全了，最好使 `sha256`，`sha512` 之类安全强度更高的散列加密算法
  :::

- 用户名密码错误不要单方面提示，如果密码错误提示用户说密码错误这样攻击者就知道用户名是对的，下次攻击密码，所以不管是用户名还是密码错误都给出同样的提示："用户名或密码错误"，或者别的不具体的提示的错误都可以

- 前端禁止用户输入导致 `sql` 注入的字符，后台也要做 `sql` 注入的防护

- 保存历史密码，一段时间没登录的用户再次登录时提示要修改密码才能登录，这时新密码不能和历史密码一样，苹果就是这么做的

- 保存每次的登录信息日志，如果登录的 `IP` 与以往有很大差别（必要时可使用异地登录告警），要引导用户重置密码方可登录

- 不要在 `cookie` 中保留用户密码，如果一定要使用 `cookie` 实现自动登录，切记不要使用简单的 `用户名＋密码MD5` 保存到`cookie`，要把用户ID、用户名、过期时间、IP、不固定的 `salt` 等一起考虑进去，这个当然要可逆，服务端要进行解密才能验证用户自动登录有效。另外，`cookie` 要设置为 `httpOnly` `这样就不能通过脚本访问 `cookie`，保证 `cookie` 的安全性

- 不要让浏览器记住密码，虽然记住密码很方便，但也不安全，所以前端最好做控制

- 一段时间类的尝试登录失败次数达到某个值，要锁定用户登录

- 设置会话有效期，比如登录后 `10` 分钟不操作就失效，要重新登录

- 验证码使用，加上干扰线，防止计算机能够轻易识别，这样也可以防止黑客以程序的方式来尝试登录。

- 手机登录的一般使用短信验证码的，控制验证码的时效性，即验证码一次有效，一分钟内只能发送一次

- 有必要的要采用单点登陆，如果允许用户多处登录的要给用户安全提醒

- 重置密码最好通过邮箱发送一定时间内生效的重置链接，或者手机短信验证码，或者两者相结合的方法，像一般的大公司都有设计一个动态密码的东西，手机即一切，所以也要妥善保管自己的动态加密的APP，最好加上指纹或手势

- 设置用户可以登录的 IP，即 IP 白名单。像比如财务系统，限制财务人员只能在办公室登录系统

- 可以考虑使用第三方授权登录接口，如 `qq` 登录，微信登录，微博登录，`github` 登录等等，优化用户登录体验
