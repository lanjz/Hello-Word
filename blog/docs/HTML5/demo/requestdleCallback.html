<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<div id="some-element-you-want-to-animate" style="width: 100px;height:100px;background: red;transition: 10s"></div>
</body>
<script>
  const element = document.getElementById('some-element-you-want-to-animate');
  let start;

  function step(timestamp) {
    if(start === undefined)
      start = timestamp;
    const elapsed = timestamp - start;
    console.log('timestamp', timestamp, elapsed)
    //这里使用`Math.min()`确保元素刚好停在200px的位置。
    element.style.transform = 'translateX(' + 200 + 'px)';
    // window.requestAnimationFrame(step);
    /*    if (elapsed < 2000) { // 在两秒后停止动画
          window.requestAnimationFrame(step);
        }*/
  }

  window.requestAnimationFrame(step);
  const tasks = [
    () => {
      console.log("第一个任务");
    },
    () => {
      console.log("第二个任务");
    },
    () => {
      console.log("第三个任务");
    },
  ]

  function myNonEssentialWork(deadline) {
    // 如果帧内有富余的时间，或者超时
    console.log('deadline', deadline, deadline.timeRemaining())
    while ((deadline.timeRemaining() > 0 || deadline.didTimeout) && tasks.length > 0) {
      work();
    }
    if(tasks.length > 0) {
      requestIdleCallback(myNonEssentialWork);
    }
  }

  function work() {
    tasks.shift()();
    console.log('执行任务');
  }

  requestIdleCallback(myNonEssentialWork, {timeout: 2000});
  /*
    for(let i=0; i<10000;i++){
      console.log("主任务", i);
    }
  */

</script>
</html>