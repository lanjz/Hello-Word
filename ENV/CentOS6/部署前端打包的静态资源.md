> [Nginx 的 try_files 指令使用实例](https://www.hi-linux.com/posts/53878.html)

> [nginx的反向代理proxy_pass指令](https://www.cnblogs.com/tugenhua0707/p/9880515.html)

以部署React资源为例，接口需要访问另个端口，即跨域

1, nginx添加`server`字段配置：

```
  server {
    listen 3002;
    root D:\Project\Demo\black-hook-note-M\build;
    index index.html;
    location / {
                  try_files $uri @fallback;
                }
    location @fallback {
                rewrite .* /index.html break;
                }
    location ^~ /api/ {
            proxy_pass http://127.0.0.1:3001/api/;
       }
  }
```

2. 执行sudo service nginx restart重启Nginx服务

说明：

- listen ：添加需要监听的端口

- root：如果监听到访问是的3002端口，刚返回`D:\Project\Demo\black-hook-note-M\build`下的站点

- index ：首页文件名

- location /： 匹配路径

  - try_files $uri @fallback;：根据路径尝试寻找文件，如果没找到则重定向到@fallback

-  location @fallback：上面没有匹配到的路径

  -   rewrite .* /index.html break;：返回首页

- location ^~ /api/：如果链接带有/api/，则访问的是接口资源，这里转发到`3001`端口上
处理

- proxy_pass：设置反向代理，该指令是用来设置代理服务器的地址，可以是主机名称，IP地址加端口号等形式

注意：

1.  `location ^~ /api/`的配置中，不能写`localhost`，要不然请求接口时第一次会失败，第二次才能成功，所以要写`127.0.0.1`

## 本地开发跨域设置的注意点

### cookiey写不到浏览器问题：

1. Access-Control-Allow-Origin"对应的值不能为通配符“*”

2. 服务端Header中设置`ctx.set("Access-Control-Allow-Credentials", true)`;

3. 在前端请求时应加入设置`withCredentials`为`true`否则，依然不会发送Cookie
