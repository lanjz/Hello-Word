<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
	let sym = Symbol('我是一个Symbol')
	const oldObj = {
		// number: 123,
		// string: '深铐贝',
		// boolean: true,
		// undefined: undefined,
		// null: null,
		obj: {
			name: '我是一个对象',
			id: 1
		},
		arr: [0, 1, 2],
		func:(() => {
			let i  = 1
            return () => {
                i = i + 1
				console.log('当前i的值：'+ i)
			}

		})(),
		date: new Date(0),
		reg: new RegExp('/我是一个正则/ig'),
		err: new Error('我是一个错误'),
		[sym]: 'key是个symbol',
		symbol: sym
	}
	oldObj.__proto__.test = 'test'
    // oldObj.my = oldObj
	function getType(data) {
		const typeToString = Object.prototype.toString.call(data)
		// Array、String、Function、Array、Number
		return typeToString.substring(8, typeToString.length - 1)
	}

	function compare(oldObj, newObj) {
		console.log('oldObj：')
		console.log(oldObj)
		console.log('newObj：')
		console.log(newObj)
		for(let i in oldObj) {
			console.log('key：'+i +' 新旧是否相等:' + (oldObj[i] == newObj[i]))
		}
		console.log('========改变值后查看两个对象的结果============')
	}
	/**
     * Object.assign()
     * */
	// const newObj = Object.assign(oldObj)
	// compare(oldObj, newObj)
    /**
     * 扩展运算付
     * */
	// const newObj = { ...oldObj }
	// compare(oldObj, newObj)

	/**
	 * 使用JSON.parse()、JSON.stringify()
	 * */
	// const newObj = JSON.parse(JSON.stringify(oldObj))
	// compare(oldObj, newObj)

    /**
     * 遍历循环
     * */
    function traversalCopy(data, weakMap = new WeakMap()) {
    	const type = getType(data)
        let obj
		// 先处理特殊对象
        if(typeof data === 'object') {
			const Constructor = data.constructor
			switch(Constructor){
				case RegExp:
					obj = new Constructor(data)
					break
				case Date:
					obj = new Constructor(data.getTime())
					break
                case Error:
                    obj = new Constructor(data)
			}
			if(obj){
				return obj
			}
        }
        if( type === 'Array' ||  type === 'Object') {
    		// 处理环问题
    		if(weakMap.get(data)) {
    			return weakMap.get(data)
            }
			obj = type === 'Array' ? [] : {}
			weakMap.set(data, obj)
        } else if(type === 'Function'){
    		return eval(data.toString())
        } else {
    		return data
        }
		// 处理symbol类型
		const findSymbol = Object.getOwnPropertySymbols(data)
        if(findSymbol.length) {
			findSymbol.forEach(item => {
				const symbolType = getType(oldObj[item])
				obj[item] = (symbolType === 'Array' || symbolType === 'Object') ?
					oldObj[item] : traversalCopy(oldObj[item], weakMap)
            })
        }
    	for(let i in data) {
    		if(type === 'Array'  || type === 'Object' ) {
				obj[i] = traversalCopy(data[i], weakMap)
            } else {
				obj[i] = data[i]
            }
        }
        return obj
	}
	compare(oldObj, newObj)

	function breadthCopy(data, weakMapObj = new WeakMap()) {
		if(!data) {
			return data
		}
		const type = getType(data)
        console.info('当前copy类型:', type)
        if(type === 'Object'  || type == 'Array') {
			const newObj = type === 'object' ? {} : []
			if(weakMapObj.get(data)) {
				return weakMapObj.get(data)
			}
			weakMapObj.set(data, newObj)
			for(let item in data) {
				newObj[item] = breadthCopy(data[item])
			}
			return newObj
        }
		if(type === 'function') {
			// todo
        }
        if(type === 'reg') {
			// todo
        }
        return data

	}

	function isObj(obj) {
		return (typeof obj === 'object' || typeof obj === 'function') && obj !== null
	}

	function deepCopy(obj, hash = new WeakMap()) {
		if(hash.has(obj)) return hash.get(obj)
		let cloneObj = Array.isArray(obj) ? [] : {}
		hash.set(obj, cloneObj)
		for(let key in obj) {
			cloneObj[key] = isObj(obj[key]) ? deepCopy(obj[key], hash) : obj[key];
		}
		return cloneObj
	}

	const obj = {
		a: 1,
	}
	obj.b = obj
	// console.log(obj)
	// console.log(breadthCopy(obj))
	// console.log('--------------')
	// console.log(deepCopy(obj))
	// JSON.parse(JSON.stringify(obj))
</script>
</body>
</html>
