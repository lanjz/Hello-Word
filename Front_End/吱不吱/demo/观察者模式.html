<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>观察者模式</title>
</head>
<body>

</body>
<script>
	const Observer = function () {
		this.obs = {}
		this.listen = function (key, fn) {
			if(!this.obs[key]) {
				this.obs[key] = []
			}
			this.obs[key].push(fn)
			console.log(`${key}成功添加订阅消息${fn}`)
		}
		this.moveAll = function (key) {
			if(this.obs[key]) {
				this.obs[key].length = 0
				console.log(`${key}成功取消所有订阅消息`)
			}
		}
		this.public = function () {
			// 取第一个参数
			const key = Array.prototype.shift.call(arguments)
			const listObs = this.obs[key]
			if(listObs) {
				listObs.forEach((fn) => {
					fn(...arguments)
				})
			}
		}
	}
	const newObs = new Observer()
	const role1Fn = function () {
		console.log('我是role1，吃饭')
	}
	const role2Fn = function () {
		console.log('我是role2，游泳')
	}
	const role2Fn2 = function () {
		console.log('我是role2，再来一次游泳')
	}
	newObs.listen('role1', role1Fn) // role1成功添加订阅消息function () {  console.log('我是role1，吃饭') }
	newObs.listen('role2', role2Fn) // role1成功添加订阅消息function () {  console.log('我是role2，游泳') }
	newObs.listen('role2', role2Fn2)// role1成功添加订阅消息function () {  console.log('我是role2，再来一次游泳') }
	newObs.public('role2') // 我是role2，游泳, 我是role2，再来一次游泳
</script>
</html>
