# Vue-router

回顾一下`vue-router`的基本用法

```
import Vue from 'vue'
import VueRouter from 'vue-router'
import App from './App'

Vue.use(VueRouter)

// 1. 定义（路由）组件。
// 可以从其他文件 import 进来
const Foo = { template: '<div>foo</div>' }
const Bar = { template: '<div>bar</div>' }

// 2. 定义路由
// 每个路由应该映射一个组件。 其中"component" 可以是
// 通过 Vue.extend() 创建的组件构造器，
// 或者，只是一个组件配置对象。
// 我们晚点再讨论嵌套路由。
const routes = [
  { path: '/foo', component: Foo },
  { path: '/bar', component: Bar }
]

// 3. 创建 router 实例，然后传 `routes` 配置
// 你还可以传别的配置参数, 不过先这么简单着吧。
const router = new VueRouter({
  routes // （缩写）相当于 routes: routes
})

// 4. 创建和挂载根实例。
// 记得要通过 router 配置参数注入路由，
// 从而让整个应用都有路由功能
const app = new Vue({
  el: '#app',
  render(h) {
    return h(App)
  },
  router
})


```

vue-router实现单页面路由跳转，提供了三种方式：hash模式、history模式、abstract模式，根据mode参数来决定采用哪一种方式。

## 路由模式

vue-router 提供了三种运行模式：

- hash: 使用 URL hash 值来作路由。默认模式。

- HTML5 History: 依赖 HTML5 History API 和服务器配置。查看 HTML5 History 模式。

- abstract: 支持所有 JavaScript 运行环境，如 Node.js 服务器端

# Vue.use(Router)

执行`Router`中的`install`方法，这个方法会给每一个组件注入 `beforeCreate` 和 `destoryed` 钩子函数，在 `beforeCreate` 做一些私有属性定义和路由初始化工作：

- 用 `defineReactive` 方法把 `this._route` 变成响应式对象, `this._router` 表示 VueRouter 的实例 `router`,它是在 `new Vue` 的时候传入的

- 给 Vue 原型上定义了 `$router` 和 `$route` 2 个属性的 get 方法

- Vue.component 方法定义了全局的 `<router-link>` 和 `<router-view> `2 个组件

# defineReactive 定义 _route

通过 Vue 的工具方法给当前应用实例定义了一个响应式的 _route 属性，值就是获取的 this._router.history.current，
也就是当前 history 实例的当前活动路由对象。给应用实例定义了这么一个响应式的属性值也就意味着如果该属性值发生了变化，就会触发更新机制，
继而调用应用实例的 render 重新渲染。还记得上一段结尾留下的疑问，也就是 history 每次更新成功后都会去更新应用实例的 _route 的值，
也就意味着一旦 history 发生改变就会触发更新机制调用应用实例的 render 方法进行重新渲染。

# vue-router路由跳转原理

1. `$router.push()` //调用方法

2. `HashHistory.push()` //根据hash模式调用,设置hash并添加到浏览器历史记录（添加到栈顶）（`window.location.hash= XXX`）

3. `History.transitionTo()` //监测更新，更新则调用History.updateRoute()

4. `History.updateRoute()` //更新路由

5. `app._route = route` //替换当前app路由

6. `vm.render()` //更新视图

路径变化是路由中最重要的功能，我们要记住以下内容：路由始终会维护当前的线路，路由切换的时候会把当前线路切换到目标线路，切换过程中会执行一系列的导航守卫钩子函数，会更改 url，同样也会渲染对应的组件