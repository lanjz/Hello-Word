# 数据驱动

![](https://ustbhuangyi.github.io/vue-analysis/assets/new-vue.png)

数据驱动就是Vue如何把模板和数据渲染成最终DOM的一个过程

# new Vue

```javascript
	const vm = new Mvue({
		el: "#app",
		render: function (createElement) {
			return createElement('div', {
				attrs: {
					id: 'app'
				},
			}, this.name)
		},
		data: {
			name: "我是MT"
		}
	});
```

# init

`new Vue`实例的时候，内部执行`init`方法，在`init`方法中合并配置，
并在Vue的`prototype`中添加`$createElement`方法，然后执行`$mount`方法

# $mount

`$mount`中的作用就是将要挂载的元素`el`或者`template`字符串转换成`render`方法。

因为在`Vue 2.0`版本中，所有`Vue`组件的渲染最终都需要`render`方法

比如`new Vue`中我们可以改写成以下形式

```javascript
const vm = new Mvue({
		el: "#app",
		render: function (createElement) {
			return createElement('div', {
				attrs: {
					id: 'app'
				},
			}, this.name)
		},
		data: {
			name: "我是MT"
		}
	});
```

# compiler

compiler中核心代码如下

```javascript
 new Watcher(vm, updateComponent, noop, {
    before () {
      if (vm._isMounted) {
        callHook(vm, 'beforeUpdate')
      }
    }
  }, true /* isRenderWatcher */)
```

`new Watcher`的时候，主要做了以下两件事情：

- 内部会执行回调函数，也就是`updateComponent`方法（渲染成DOM的方法）

- 对数据通过`Object.defineProperty`处理，这样就可以实现对数据的监听

`Watcher`内部具体实现我们放在下一章解释，这里的重点是`updateComponent`方法的实现

`updateComponent`函数定义如下

```javascript
 updateComponent = () => {
      vm._update(vm._render())
    }
```

## _render

`_render`方法就是把实例渲染成一个虚拟Node

Vue源码中`_render`方法内部会执行`render.call(vm._renderProxy, vm.$createElement)`

