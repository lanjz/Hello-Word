# Linux容器

> [了解Linux容器](https://www.redhat.com/zh/topics/containers)
> [Docker 入门教程](https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html)

如今，各种应用变得越来越复杂，加速开发的需求也与日俱增。这让您的基础架构 IT团队以工作流程压力重重。
Linux容器可帮助您踌多种环境，有效减缓问题，加速迭代

部署软件的一个麻烦事之一，就是环境配置：操作系统的设置，各种库和组件的安装，只有它们都正确，软件才能运行。如果需要将软件
换一台机器部署，就得重来一次，而且就配置之后，软件未必能正常运行。有哪些方式能解决这么问题呢

## 什么是Linux容器

Linux®容器是与系统其他部分隔离开的一系列进程。运行这些进程所需的所有文件都由另一个镜像提供，
这意味着从开发到测试再到生产的整个过程中，Linux 容器都具有可移植性和一致性。
因而，相对于依赖重复传统测试环境的开发渠道，容器的运行速度要快得多

Linux容器技术能够让您对应用及其整个运行的环境（包括依赖的库等文件）一起进行打包或隔离。
从而让你可以在不同环境（如开发，测试和生产
等环境）之间轻松迁移应用。同时还可以保留应用的全部功能。

假设您在开发一个应用。您使用的是一台笔记本电脑，而且您的开发环境具有特定的配置。
其他开发人员身处的环境配置可能稍有不同。您正在开发的应用不止依赖于您当前的配置，还需要某些特定的库、依赖项和文件。
与此同时，您的企业还拥有标准化的开发和生产环境，有着自己的配置和一系列支持文件。
您希望尽可能多在本地模拟这些环境，而不产生重新创建服务器环境的开销。
因此，您要如何确保应用能够在这些环境中运行和通过质量检测，并且在部署过程中不出现令人头疼的问题，
也无需重新编写代码和进行故障修复？答案就是使用容器。

容器可以确保您的应用拥有必需的库、依赖项和文件，让您可以在生产中自如地迁移这些应用，无需担心会出现任何负面影响。实际上，
您可以将容器镜像中的内容，视为 Linux 发行版的一个安装实例，因为其中完整包含 RPM 软件包、配置文件等内容。
但是，安装容器镜像发行版，要比安装新的操作系统副本容易得多。这样可以避免危机，做到皆大欢喜。

> 容器也是保障IT安全的一个重要组成部分。将安全性内置于容器管道，可以为您的基础架构增添防护，从而保障容器的可靠性，可扩拓展性和
>依赖度

Linux容器还有利明确划分职责范围，减少开发和运维团队间的冲突。这样，开发人员可以全心投入应用开发，
而运维团队则可专注于基础架构维护。

## 容器不就是虚拟化吗？

不完全如此。更确切的说法应该是：两者为互补关系。我们用一种简单方式来思考一下：

- 虚拟化使得您的操作系统（Windows 或 Linux）可同时在单个硬件系统上运行

- 容器则可共享同一个操作系统内核，将应用进程与系统其他部分隔离开。例如：ARM Linux 系统运行 ARM Linux 容器，x86 Linux 系统运行 x86 Linux 容器，x86 Windows 系统运行 x86 Windows 容器。Linux 容器具有极佳的可移植性，但前提是它们必须与底层系统兼容

![](https://www.redhat.com/cms/managed-files/virtualization-vs-containers.png)

这意味着什么？虚拟化会使用虚拟机监控程序模拟硬件，从而使多个操作系统能够并行运行。但这不如容器轻便。事实上，
在仅拥有容量有限的有限资源时，您需要能够可以进行密集部署的轻量级应用。Linux 容器在本机操作系统上运行，
与所有容器中共享该操作系统，因此应用和服务能够保持轻巧，并行化快速运行。

Linux 容器是我们开发、部署和管理应用方式的又一次飞跃。Linux 容器镜像提供了可移植性和版本控制，
确保能够在开发人员的笔记本电脑上运行的应用，同样也能在生产环境中正常运行。相较于虚拟机，Linux 容器在运行时所占用的资源更少，
使用的是标准接口（启动、停止、环境变量等），并会与应用隔离开；此外，作为（包含多个容器）大型应用的一部分时更加易于管理，
而且这些多容器应用可以跨多个云环境进行编排。

# 容器与虚拟机的区别

## 虚拟机

虚拟机（virtual machine）就是带环境安装的一种解决方案。它可以在一种操作系统里面运行另一种操作系统，
比如在 Windows 系统里面运行 Linux 系统。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，
而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。

虽然用户可以通过虚拟机还原软件的原始环境。但是，这个方案有几个缺点。

- 资源占用多

  虚拟机会独占一部分内存和硬盘空间。它运行的时候，其他程序就不能使用这些资源了。哪怕虚拟机里面的应用程序，真正使用的内存只有 1MB，
虚拟机依然需要几百 MB 的内存才能运行。

- 冗余步骤多

  虚拟机是完整的操作系统，一些系统级别的操作步骤，往往无法跳过，比如用户登录。
  
- 启动慢

  启动操作系统需要多久，启动虚拟机就需要多久。可能要等几分钟，应用程序才能真正运行。
  
## Linux 容器

由于虚拟机存在这些缺点，Linux 发展出了另一种虚拟化技术：Linux 容器（Linux Containers，缩写为 LXC）

**Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。**或者说，在正常进程的外面套了一个保护层。
对于容器里面的进程来说，它接触到的各种资源都是虚拟的，从而实现与底层系统的隔离

由于容器是进程级别的，相比虚拟机有很多优势。

- 启动快

  容器里面的应用，直接就是底层系统的一个进程，而不是虚拟机内部的进程。所以，启动容器相当于启动本机的一个进程，而不是启动一个操作系统，速度就快很多。
  
- 资源占用少
  
容器只占用需要的资源，不占用那些没有用到的资源；虚拟机由于是完整的操作系统，不可避免要占用所有资源。另外，多个容器可以共享资源，虚拟机都是独享资源。

- 体积小

  容器只要包含用到的组件即可，而虚拟机是整个操作系统的打包，所以容器文件比虚拟机文件要小很多。
  
 总之，容器有点像轻量级的虚拟机，能够提供虚拟化的环境，但是成本开销小得多。
 
 
# Docker

> [Red Hat - 什么是Docker](https://www.redhat.com/zh/topics/containers/what-is-docker)

# 什么是Docker
 
Docker是指容器化技术，用于支持创建和使用Linux容器，Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。
它是目前最流行的 Linux 容器解决方案。

借助Docker,你可将容器当做轻巧，模块化的虚拟机使用。同时，你还将获得高度的灵活性，从而实现
对容器的高效创建，部署及复制，并能将其从一个环境顺利迁移至另一个环境

## Docker如何工作

Docker技术使用Linux内核和内核功能（例如Cgroups和namespaces）来分隔进程，以便各进程相互独立运行。这种独立性正是采用容
器的目的所在；它可以独立运行多种进程，多个应用，更加充分地发挥基础设施的作用，同时保持各个独立系统的安全性

容器工具（包括 Docker）可提供基于镜像的部署模式。这使得它能够轻松跨多种环境，与其依赖程序共享应用或服务组。
Docker 还可在这一容器环境中自动部署应用（或者合并多种流程，以构建单个应用）。

此外，由于这些工具基于 Linux 容器构建，使得 Docker 既易于使用，又别具一格——它可为用户提供前所未有的高度应用程访问权限、
快速部署以及版本控制和分发能力。
 

## Docker的优势

- 模块化

  Docker 容器化方法非常注重在不停止整个应用的情况下，单独截取部分应用进行更新或修复的能力。除了这种基于微服务的方法，
  您还可以采用与面向服务的架构（SOA）类似的使用方法，在多个应用间共享进程。
  
- 层和镜像版本控制

  每个 Docker 镜像文件都包含多个层。这些层组合在一起，构成单个镜像。每当镜像发生改变时，就会创建一个新的镜像层。
  用户每次发出命令（例如 run 或 copy）时，都会创建一个新的镜像层。
  
  Docker 重复使用这些层来构建新容器，借此帮助加快流程构建。镜像之间会共享中间变化，从而进一步提升速度、规模以及效率。
  版本控制是镜像层本身自带的能力。每次发生新的更改时，您大都会获得一个内置的更改日志，实现对容器镜像的全盘管控。
  
- 回滚

  回滚也许是层最值得一提的功能。每个镜像都拥有多个层。举例而言，如果您不喜欢迭代后的镜像版本，完全可以通过回滚，返回之前的版本。
  这一功能还支持敏捷开发方法，帮助持续实施集成和部署（CI/CD），使其在工具层面成为一种现实。
  
- 快速部署

  启动和运行新硬件、实施部署并投入使用，这在过去一般需要数天时间。投入的心力和成本往往也让人不堪重负。
  基于 Docker 的容器可将部署时间缩短到几秒。
  通过为每个进程构建容器，您可以快速将这些类似进程应用到新的应用程序中。
  而且，由于无需启动操作系统即可添加或移动容器，因此大幅缩短了部署时间。
    除此之外，得益于这种部署速度，您可以轻松无虞、经济高效地创建和销毁容器创建的数据。
    
## Docker 的用途
 
 Docker 的主要用途，目前有三大类。
 
 - 提供一次性的环境。比如，本地测试他人的软件、持续集成的时候提供单元测试和构建的环境。
 
 - 提供弹性的云服务。因为 Docker 容器可以随开随关，很适合动态扩容和缩容。
 
 - 组建微服务架构。通过多个容器，一台机器可以跑多个服务，因此在本机就可以模拟出微服务架构。
    
## 使用 Docker 时有哪些限制？

Docker 本身非常适合用于管理单个容器。但随着您开始使用越来越多的容器和容器化应用，并把它们划分成数百个部分，很可能会导致管理和编排变得非常困难。
最终，您需要后退一步，对容器实施分组，以便跨所有容器提供网络、安全、遥测等服务。于是，Kubernetes 应运而生。

使用 Docker，您将获得与传统 Linux 容器不同的类 UNIX 功能，包括可以随同应用一起，
在容器中使用 cron 或 syslog 之类的进程。当然，在某些事情上面也存在一些限制，
例如终止子进程之后，需要清理孙进程，而对于这类事情，传统 Linux 容器会自行处理。
但我们可以在开始时更改配置文件和设置功能，从而消除这些顾虑，这些都是瑕不掩瑜的小问题。

除此以外，有些其它 Linux 子系统和设备也未指定命名空间。它们包括 SELinux、Cgroups 以及 /dev/sd* 设备。
这意味着，如果攻击者控制了这些子系统，主机也将不保。为了保持轻量，主机与容器共享内核，也因此埋下了安全漏洞的隐患。
在这一点上，它与虚拟机不同，后者更加严格地与主机系统保持隔离。

## Docker容器真的安全吗

Docker 守护进程也可能成为安全隐患。为使用和运行 Docker 容器，您很可能需要使用 Docker 守护进程，
来为容器提供持续运行时环境。Docker 守护进程需要根权限，所以我们需要特别留意谁可以访问该进程，
以及进程驻留在哪个位置。例如，相比公共区域所用的守护进程（例如 Web 服务器），本地守护进程的受攻击面要小得多。
